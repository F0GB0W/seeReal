<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

	<!-- 이메일 중복체크를 위한 select -->
	<select id="selectEmail" parameterType="String" resultType="_int">
		select
			  member_email
		  from 
		      member
		 where 
		      status = 'Y'
		   and 
		      member_email = #{email}
	</select>

	<!-- 이메일 전송 후, 인증을 위한 Cert테이블에 insert -->
	<insert id="insertCert" parameterType="cert">
		insert 
		  into 
		      cert
		      (
		       who
		       ,secret
		       ,when
		       ) 
		       values
		       (
		       #{who}
		       ,#{secret}
		       ,sysdate
		       )
	</insert>
	
	<!-- 이메일 인증 번호 체크 select -->
	<select id = "selectCert" parameterType="cert" resultType="_int">
		select
		  from
			  cert
		 where 
			  who = #{who}
		   and 
		      secret = #{secret}
		   and 
		      when = between sysdate - 3/24/60 and sysdate
	</select>
	
	<delete id="deleteCert" parameterType="cert">
		delete 
		  from 
		      cert
		 where 
		      who = #{who}
		   and 
		      secret = #{secret}
	</delete>
	
	<!-- 닉네임 중복체크를 위한 select -->
	<select id ="selectNickname" parameterType="String" resultType="_int">
		select
			  count(*)
	      from 
	          member
	     where 
	          status='Y'
	       and 
	          member_nickname = #{nickname}
	</select>

</mapper>
