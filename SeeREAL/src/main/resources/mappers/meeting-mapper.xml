<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="meetingMapper">

	<resultMap id="meetingResultSet" type="meeting">
		<result column="MEETING_NO" property="meetingNo" />
		<result column="MEETING_TITLE" property="meetingTitle" />
		<result column="MEETING_EXP" property="meetingExp" />
		<result column="MEETING_PLACE" property="meetingPlace" />
		<result column="MEETING_PLACE_DETAIL" property="meetingPlaceDetial" />
		<result column="MOVIE_TITLE" property="movieTitle" />
		<result column="MOVIE_YEAR" property="movieYear" />
		<result column="STATUS" property="status" />
		<result column="MEETING_ENROLL" property="meetingEnrollDate" />
		<result column="MEMBER_NO" property="memberNo" />
		<result column="MEETING_REPORT" property="meetingReport" />
		<result column="MEETING_WRITER" property="meetingWriter" />
	</resultMap>

	<insert id="insertMeeting" parameterType="meeting">
		INSERT INTO
			MEETING
				(
				 MEETING_NO
				,MEETING_TITLE
				,MEETING_EXP
				,MEETING_PLACE
				,MEETING_PLACE_DETAIL
				,MOVIE_TITLE
				,MOVIE_YEAR
				,MEMBER_NO
				)
			VALUES
				(
				 SEQ_METNO.NEXTVAL
				,#{ meetingTitle }
				,#{ meetingExp }
				,#{ meetingPlace }
				,#{ meetingPlaceDetail }
				,#{ movieTitle }
				,#{ movieYear }
				,#{ memberNo }
				)
	
	</insert>
	

	<select id="selectMeetingListCount" resultType="_int">
		SELECT
			COUNT(*)
		FROM
			MEETING
		WHERE
			STATUS = 'Y'
	</select>

	<select id="selectMeetingList" resultMap="meetingResultSet">
		SELECT
			MEETING_NO,
			MEETING_TITLE,
			MEETING_ENROLL,
			NICK_NAME AS MEETING_WRITER,
			MEMBER.MEMBER_NO AS MEMBER_NO
		FROM
			MEETING
		JOIN MEMBER ON
			(MEMBER.MEMBER_NO = MEETING.MEMBER_NO)
		WHERE
			MEETING.STATUS = 'Y'
	</select>
	
	<update id="increaseMeetingCount" parameterType="_int">
		UPDATE
			MEETING
		SET
			COUNT = COUNT + 1
		WHERE
			MEETING_NO = #{ mtno }
			AND STATUS = 'Y'
			
	</update>


</mapper>
